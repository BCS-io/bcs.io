#!/usr/bin/env bash


#
# list webserver log files
#

server=noss.bcs.io
ansible_path="./ansible/web"

print_usage() {
  printf "dbg_log help\n\n"
  printf "Listing NGINX log files:\n"
  printf "a access.log\n"
  printf "A bcs-io-access.log\n"
  printf "e error.log\n"
  printf "E bcs-io-error.log\n"
  printf "\n"
  printf "Limiting of playbook hosts - optional:\n"
  printf "  -d development\n"
  printf "  -p production (default)\n"

}

log_file=''

if [ $# -eq 0 ]; then
  print_usage
  exit
fi


while getopts 'aAbdeEhp' flag; do
  case "${flag}" in
    a) log_file=access.log ;;
    d) server='noss.bcs.io' ;;
    A) log_file=bcs-io-access.log ;;
    e) log_file=error.log ;;
    E) log_file=bcs-io-error.log ;;
    h) print_usage
       exit 1 ;;
    p) server='papa.bcs.io' ;;
    *) print_usage
       exit 1;;
  esac
done


if [[ -n $log_file ]]; then
  log_file="/var/log/nginx/${log_file}"
  echo "NGINX Logs: ${server} ${log_file}"
  echo ""

  cd $ansible_path && ansible $server -a "cat ${log_file}" --inventory hosts.ini
fi
